language: rust
cache: cargo
rust:
- stable
sudo: required
os:
- linux

matrix:
  include:
    - env: 
      - TARGET=arm-unknown-linux-gnueabihf
      - RUSTFLAGS="-C linker=arm-linux-gnueabihf-gcc -L/usr/arm-linux-gnueabihf/lib -L$TRAVIS_BUILD_DIR/deps_root/usr/lib/arm-linux-gnueabihf"
      #- PKG_CONFIG_ALLOW_CROSS=1
      #- OPENSSL_DIR=$TRAVIS_BUILD_DIR/temp_ssl
      - SHORT_TARGET=armv6
      addons:
        apt:
          packages:
            - gcc-arm-linux-gnueabihf
            - libc6-armhf-cross
            - libc6-dev-armhf-cross
            - libasound2-dev
            - libssl-dev
      before_script:
        - echo "deb [arch=armhf] http://ports.ubuntu.com/ubuntu-ports/ trusty main" | sudo tee -a /etc/apt/sources.list
        - sudo apt-get update
        - sudo apt-get download libasound2:armhf
        - sudo apt-get download libssl-dev:armhf
        - dpkg dpkg -x libasound2_1.1.3-5_armhf.deb $TRAVIS_BUILD_DIR/deps_root/
        - dpkg dpkg -x libssl1.1_1.1.0g-2ubuntu4_armhf.deb $TRAVIS_BUILD_DIR/deps_root/
      
script:
- rustup target add $TARGET
- cargo build --target=$TARGET --release
- zip -j spotifyd-`date --iso-8601`-$SHORT_TARGET.zip target/$TARGET/release/spotifyd

#deploy:
#  provider: releases
#  file_glob: true
#  api_key: $GITHUB_TOKEN
#  skip_cleanup: true
#  on:
#branch: arm_travis
